<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- bootstrap-daterangepicker -->
    <link href="../vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
    <!-- bootstrap-datetimepicker -->
    <link href="../vendors/bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.css" rel="stylesheet">
    <!-- Ion.RangeSlider -->
    <link href="../vendors/normalize-css/normalize.css" rel="stylesheet">
    <link href="../vendors/ion.rangeSlider/css/ion.rangeSlider.css" rel="stylesheet">
    <link href="../vendors/ion.rangeSlider/css/ion.rangeSlider.skinFlat.css" rel="stylesheet">
    <!-- Bootstrap Colorpicker -->
    <link href="../vendors/mjolnic-bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css" rel="stylesheet">

    <link href="../vendors/cropper/dist/cropper.min.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">
    <style>
        .editor_pic {
            cursor: pointer;
            font-size: 20px;
            color: red;
        }

        .modal-body input[type=text] {
            display: none;
        }

        iframe {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>

<body class="nav-md">

    <div class="container body">
        <div class="main_container">
            <div class="col-md-3 left_col">
                <div class="left_col scroll-view">
                    <div class="navbar nav_title" style="border: 0;">
                        <a href="index.html" class="site_title"><i class="fa fa-paw"></i> <span>GBIKE </span></a>
                    </div>

                    <div class="clearfix"></div>

                    <!-- menu profile quick info -->
                    <div class="profile clearfix">
                        <div class="profile_pic">
                            <img src="<%= acc_avatar %>" alt="..." class="img-circle profile_img">
                        </div>
                        <div class="profile_info">
                            <span>Xin chào,</span>
                            <h2><%= acc_name %></h2>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <!-- /menu profile quick info -->

                    <br />

                    <!-- sidebar menu -->
                    <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
                        <div class="menu_section">
                            <h3>General</h3>
                            <ul class="nav side-menu">
                                <li><a><i class="fa fa-home"></i> Home <span class="fa fa-chevron-down"></span></a>

                                </li>

                            </ul>
                        </div>


                    </div>
                    <!-- /sidebar menu -->

                    <!-- /menu footer buttons -->
                    <div class="sidebar-footer hidden-small">
                        <a data-toggle="tooltip" data-placement="top" title="Settings">
                            <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
                        </a>
                        <a data-toggle="tooltip" data-placement="top" title="FullScreen">
                            <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
                        </a>
                        <a data-toggle="tooltip" data-placement="top" title="Lock">
                            <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
                        </a>
                        <a data-toggle="tooltip" data-placement="top" title="Logout" href="logout">
                            <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
                        </a>
                    </div>
                    <!-- /menu footer buttons -->
                </div>
            </div>

            <!-- top navigation -->
            <div class="top_nav">
                <div class="nav_menu">
                    <div class="nav toggle">
                        <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                    </div>
                    <nav class="nav navbar-nav">
                        <ul class=" navbar-right">
                            <li class="nav-item dropdown open" style="padding-left: 15px;">
                                <a href="javascript:;" class="user-profile dropdown-toggle" aria-haspopup="true"
                                    id="navbarDropdown" data-toggle="dropdown" aria-expanded="false">
                                    <img src="<%= acc_avatar %>" alt=""><%= acc_name %>
                                </a>
                                <div class="dropdown-menu dropdown-usermenu pull-right"
                                    aria-labelledby="navbarDropdown">
                                    <a class="dropdown-item" href="javascript:;"> Profile</a>
                                    <a class="dropdown-item" href="javascript:;">
                                        <span class="badge bg-red pull-right">50%</span>
                                        <span>Settings</span>
                                    </a>
                                    <a class="dropdown-item" href="javascript:;">Help</a>
                                    <a class="dropdown-item" href="logout"><i class="fa fa-sign-out pull-right"></i> Log
                                        Out</a>
                                </div>
                            </li>


                        </ul>
                    </nav>
                </div>

            </div>
            <!-- /top navigation -->

            <!-- page content -->
            <div class="right_col" role="main">

                <div class="row">
                    <div class="col-md-6 ">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>Thông tin đồ thế<small> Hợp đồng số <span id="id_hopdong"> <%= lastid %></span></small></h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>

                                    <li><a class="close-link"><i class="fa fa-close"></i></a>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <br />
                                <form class="form-label-left input_mask" autocomplete="off">

                                    <div class="col-md-6 col-sm-6  form-group has-feedback">

                                        <input type="text" name="name" class="form-control has-feedback-left"
                                            id="ipt_name" required placeholder="Họ tên">
                                        <span class="fa fa-user form-control-feedback left" aria-hidden="true"></span>
                                    </div>

                                    <div class="col-md-6 col-sm-6  form-group has-feedback">
                                        <input required id="ipt_phone" type="text" name="phone" class="form-control"
                                            placeholder="Số Điện thoại" title="Nhập đúng số điện thoại">
                                        <span class="fa fa-phone form-control-feedback right" aria-hidden="true"></span>
                                    </div>

                                    <div class="col-md-6 col-sm-6  form-group has-feedback">
                                        <input data-type="currency" required type="text" name="money"
                                            class="form-control has-feedback-left" id="ipt_money" placeholder="Số tiền">
                                        <span class="fa fa-money form-control-feedback left" aria-hidden="true"></span>
                                    </div>
                                    <div class="col-md-6 col-sm-6  form-group has-feedback">
                                        <input required type="text" value="<%= acc_name %>" name="sale"
                                            class="form-control has-feedback-left" id="ipt_sale" placeholder="Nhân viên"
                                            readonly="readonly">
                                        <span class="fa fa-user form-control-feedback right" aria-hidden="true"></span>
                                    </div>
                                    <div class="col-md-6 col-sm-6  form-group has-feedback">
                                        <input autocomplete="false" type="text" name="cmnd" class="form-control has-feedback-left"
                                            id="ipt_cmnd" placeholder="CMND">
                                        <span class="fa fa-credit-card form-control-feedback left"
                                            aria-hidden="true"></span>
                                    </div>
                                    <div class="col-md-6 col-sm-6  form-group has-feedback">
                                        <input required type="text" name="cmnd_date"
                                            class="form-control has-feedback-left" id="ipt_cmnd_date"
                                            placeholder="Ngày cấp">
                                        <span class="fa fa-calendar form-control-feedback right"
                                            aria-hidden="true"></span>
                                    </div>


                                    <div class="col-md-6 col-sm-6  form-group has-feedback">
                                        <label>Ngày thế</label>
                                        <div class="form-group">
                                            <div class='input-group date' id='myDatepicker'>
                                                <input required type='text' id="ipt_date" name="ngaythe"
                                                    class="form-control" />
                                                <span class="input-group-addon">
                                                    <span class="fa fa-calendar"></span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-sm-6  form-group has-feedback">
                                        <label>Ngày tới hạn</label>
                                        <input type="text" id="ngaytoihan" name="ngaytoihan"
                                            class="form-control has-feedback-left" placeholder="" readonly>

                                    </div>






                            </div>
                            <div class="form-group row">
                                <div class="form-group row" id="pawn_item_detail">
                                    <label class="col-form-label col-md-3 col-sm-3 "><label for="heard">Món *:</label>
                                        <select id="item" name="mondo" class="form-control" required>
                                            
                                            <option selected value="xemay">Xe máy</option>
                                            <option value="xe đạp điện">Xe đạp điện</option>
                                            <option value="điện thoại">Điện thoại</option>
                                            <option value="khác">Khác</option>
                                        </select></label>
                                    <div class="col-md-9 col-sm-9">
                                        <div class="col-md-6 col-sm-6  form-group has-feedback">
                                            <input title="Điền đúng tên người" list="xe_datalist"
                                                type="text" name="ipt_item_name" class="form-control has-feedback-left"
                                                id="ipt_item_name" placeholder="Nhãn hiệu">
                                            <span class="fa fa-envelope form-control-feedback left"
                                                aria-hidden="true"></span>
                                            <datalist id="xe_datalist">
                                                <option selected value="Exciter">
                                                <option value="Cub">
                                                <option value="Wave">
                                                <option value="Honda Vision">
                                                <option value="Xe phổ thông 10tr">
                                                <option value="Xe ga 30tr">
                                                <option value="Xe cao cấp 50tr">
                                            </datalist>
                                        </div>
                                        <div class="col-md-6 col-sm-6  form-group has-feedback">
                                            <input list="color_datalist" type="text" name="ipt_item_color"
                                                class="form-control has-feedback-left" id="ipt_item_color"
                                                placeholder="Màu">
                                            <datalist id="color_datalist">
                                                <option selected value="Xanh lá">
                                                <option value="Đỏ">
                                                <option value="Vàng">
                                                <option value="Xanh biển">
                                                <option value="Đen">
                                                <option value="Xám">
                                                <option value="Cam">
                                                <option value="Hồng">
                                                <option value="phổ thông">

                                            </datalist>
                                            <span class="fa fa-envelope form-control-feedback left"
                                                aria-hidden="true"></span>
                                        </div>
                                        <div class="col-md-6 col-sm-6  form-group has-feedback">
                                            <input required type="text" name="ipt_item_cavet"
                                                class="form-control has-feedback-left" id="inputSuccess4"
                                                placeholder="Biển số">
                                            <span class="fa fa-envelope form-control-feedback left"
                                                aria-hidden="true"></span>
                                        </div>
                                        <div class="col-md-6 col-sm-6  form-group has-feedback">
                                            <input required type="text" name="ipt_item_tinhtrang"
                                                class="form-control has-feedback-left" id="ipt_item_tinhtrang"
                                                placeholder="Tình trạng">
                                            <span class="fa fa-wrench form-control-feedback left"
                                                aria-hidden="true"></span>
                                        </div>


                                        <div class="col-md-6 col-sm-6">
                                            <label>Ảnh</label>
                                            <div id="results" style="width: 320px;height: 240px;color:bisque">

                                            </div>
                                            <br />
                                            <div id="my_camera"></div>
                                        </div>

                                    </div>
                                    <div> <input type="button" class="btn btn-primary" value="Chụp"
                                            style="position: absolute;width:20%;margin-left: -97%;margin-top:40%"
                                            onClick="take_snapshot()"></div>
                                    <div> <input type="button" class="btn btn-primary" value="xác nhận ảnh"
                                            style="position: absolute;width:25%;margin-left: -99%;margin-top:50%"
                                            onClick="uploadPic()"></div>
                                </div>


                            </div>

                            <div class="form-group row">
                                <div class="col-md-12 col-sm-12  form-group has-feedback">
                                    <label for="heard">Lãi xuất (%) :</label>
                                    <select id="ipt_laixuat" name="ipt_laixuat" class="form-control" required>
                                        <option selected value="3">3</option>
                                        <option value="3.5">3.5</option>
                                        <option value="4">4</option>
                                        <option value="4.5">4.5</option>
                                        <option value="5">5</option>
                                        <option value="5.5">5.5</option>
                                        <option value="6">6</option>
                                    </select></label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 ">Ghi Chú</label>
                                <div class="col-md-9 col-sm-9 ">
                                    <textarea id="ipt_ghichu" name="ghichu" class="resizable_textarea form-control"
                                        placeholder=""></textarea>
                                </div>
                            </div>




                        </div>

                        <div class="form-group">
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <button class="btn btn-primary" disabled type="button" id="btn_xemtruoc"
                                  onclick="xemtruoc();">Xem
                                    trước</button>
                                <button class="btn btn-primary" type="reset">Reset</button>
                                <button type="submit" class="btn btn-success">Đồng ý</button>
                            </div>
                        </div>

                        </form>
                    </div>
                    <div class="col-md-6">
                        <iframe class="zoom" id="iframe_xemtruoc" src=""></iframe>
                    </div>

                </div>
            </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <footer>
            <div class="pull-right">
                baotm - Bootstrap Admin Template by <a href="https://colorlib.com">Colorlib</a>
            </div>
            <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
    </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
        integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"
        integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1"
        crossorigin="anonymous"></script>
    <!-- jQuery -->

    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../vendors/nprogress/nprogress.js"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="../vendors/moment/min/moment.min.js"></script>
    <script src="../vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
    <!-- bootstrap-datetimepicker -->
    <script src="../vendors/bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <!-- Ion.RangeSlider -->
    <script src="../vendors/ion.rangeSlider/js/ion.rangeSlider.min.js"></script>
    <!-- Bootstrap Colorpicker -->
    <script src="../vendors/mjolnic-bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js"></script>
    <!-- jquery.inputmask -->
    <script src="../vendors/jquery.inputmask/dist/min/jquery.inputmask.bundle.min.js"></script>
    <!-- jQuery Knob -->
    <script src="../vendors/jquery-knob/dist/jquery.knob.min.js"></script>
    <!-- Cropper -->
    <script src="../vendors/cropper/dist/cropper.min.js"></script>
    <script src="js/webcam.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#myDatepicker').datetimepicker({
                format: 'DD/MM/YYYY',
                defaultDate: new Date()
            }).on('onload', function () {
                //get date
                _date = $("#ipt_date").val().split('/');

                var date = new Date(_date[2], _date[1], _date[0]);
                date.setMonth(date.getMonth() + 3)
                date_end_count = getDayFormat(date);
                $('#ngaytoihan').val(date_end_count)
            });

            $("#myDatepicker").trigger('onload');


        });

    </script>
    <script language="JavaScript">
        Webcam.set({
            width: 320,
            height: 240,
            image_format: 'jpeg',
            jpeg_quality: 90,

        });

        Webcam.attach('#my_camera');
        function getDayFormat(date) {
            var today = date;
            var dd = today.getDate();
            var mm = today.getMonth(); //January is 0!
            var yyyy = today.getFullYear();
            if (dd < 10) {
                dd = '0' + dd;
            }
            if (mm < 10) {
                mm = '0' + mm;
            }
            var today = dd + '/' + mm + '/' + yyyy;
            return today;
        }
        function take_snapshot() {
            Webcam.snap(function (data_uri) {
                document.getElementById('results').innerHTML =
                    '<img id="img_base64" src="' + data_uri + '"/>';
            });
        }
        url = "";
        function xemtruoc() {

            name = document.querySelector("#ipt_name").value;
            phone = document.querySelector("#ipt_phone").value;
            money = document.querySelector("#ipt_money").value;
            sale = document.querySelector("#ipt_sale").value;
            cmnd = document.querySelector("#ipt_cmnd").value;
            cmnd_date = document.querySelector("#ipt_cmnd_date").value;
            date_p = document.querySelector("#ipt_date").value;
            item_name = document.querySelector("#ipt_item_name").value;
            item_color = document.querySelector("#ipt_item_color").value;
            item_tinhtrang = document.querySelector("#ipt_item_tinhtrang").value;
            laixuat = $("#ipt_laixuat :selected").text();
            ghichu = document.querySelector("#ipt_ghichu").value;
            cavet = "12312";
            str = "bill?name=" + name + "&";
            str += "phone=" + phone + "&";
            str += "money=" + money + "&";
            str += "sale=" + sale + "&";
            str += "cmnd=" + cmnd + "&";
            str += "cmnd_date=" + cmnd_date + "&";
            str += "date_p=" + date_p + "&";
            str += "item_name=" + item_name + "&";
            str += "item_color=" + item_color + "&";
            str += "item_tinhtrang=" + item_tinhtrang + "&";
            str += "laixuat=" + laixuat + "&";
            str += "ghichu=" + ghichu + "&";
            str += "cavet=" + cavet + "&";
            str += "url=" + url;


            document.querySelector("#iframe_xemtruoc").src = str;

        }

        function uploadPic() {
            base64image = document.querySelector("#img_base64").src;
            id=document.querySelector("#id_hopdong").innerHTML;
            date = document.querySelector("#ipt_date").value;
            
            date = date.replace(/\//g,"");

            
            nameOfpicture = id+"-"+date;
            $.ajax({
                url: '/upload_picture',
                type: 'POST',
                data: {
                    img: base64image,
                    //id-date-name
                    name:nameOfpicture
                },
                success: function (data) {
                    url = data;
                    document.getElementById("btn_xemtruoc").disabled = false;
                },
            });

        }
    </script>
    <script>
        //format currency

        $("input[data-type='currency']").on({
            keyup: function () {
                formatCurrency($(this));
            },
            blur: function () {
                formatCurrency($(this), "blur");
            }
        });


        function formatNumber(n) {
            // format number 1000000 to 1,234,567
            return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ",")
        }


        function formatCurrency(input, blur) {
            // appends $ to value, validates decimal side
            // and puts cursor back in right position.

            // get input value
            var input_val = input.val();

            // don't validate empty input
            if (input_val === "") { return; }

            // original length
            var original_len = input_val.length;

            // initial caret position 
            var caret_pos = input.prop("selectionStart");

            // check for decimal
            if (input_val.indexOf(".") >= 0) {

                // get position of first decimal
                // this prevents multiple decimals from
                // being entered
                var decimal_pos = input_val.indexOf(".");

                // split number by decimal point
                var left_side = input_val.substring(0, decimal_pos);
                var right_side = input_val.substring(decimal_pos);

                // add commas to left side of number
                left_side = formatNumber(left_side);

                // validate right side
                right_side = formatNumber(right_side);

                // On blur make sure 2 numbers after decimal
                if (blur === "blur") {
                    right_side += "00";
                }

                // Limit decimal to only 2 digits
                right_side = right_side.substring(0, 2);

                // join number by .
                input_val = left_side ;

            } else {
                // no decimal entered
                // add commas to number
                // remove all non-digits
                input_val = formatNumber(input_val);
                input_val = input_val ;

                // final formatting
                if (blur === "blur") {
                    input_val += "";
                }
            }

            // send updated string to input
            input.val(input_val);

            // put caret back in the right position
            var updated_len = input_val.length;
            caret_pos = updated_len - original_len + caret_pos;
            input[0].setSelectionRange(caret_pos, caret_pos);
        }

    </script>
</body>



</html>